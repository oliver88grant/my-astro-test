---
import products from '@/data/products.json';
import Layout from '../../layouts/Layout.astro';
import "../../styles/global.css";

import '@splidejs/splide/css';
import 'vlitejs/vlite.css';

// import GalleryCarousel from '@/components/GalleryCarousel.jsx';



const { slug } = Astro.params;

// Find the matching product
const product = products.find(p => p.slug === slug);

if (!product) {
  throw new Error(`Product not found: ${slug}`);
}


// Sort media: video first, then image
const sortedMedia = [
  ...product.media.filter(item => item.type === 'video'),
  ...product.media.filter(item => item.type === 'image'),
];

export async function getStaticPaths() {
  return products.map(product => ({
    params: { slug: product.slug },
  }));
}
---


<Layout>
	<body class="p-6">
    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
      <div class="splide mt-4" id="product-carousel">
        <div class="splide__track">
          <ul class="splide__list">
            {sortedMedia.map((item, index) => (
              <li class="splide__slide" key={index}>
                {item.type === 'video' ? (
                  <div class="video-container w-full h-full relative">
                    <video id="product-video" controls muted class="w-full rounded-lg object-contain h-full">
                      <source src={item.src} type="video/mp4" />
                      Your browser does not support the video tag.
                    </video>
                  </div>
                  
                ) : (
                  <img src={item.src} alt={`Media ${index + 1}`} class="w-full rounded-lg object-contain h-full" />
                )}
              </li>
            ))}
          </ul>
        </div>
      </div>
      <div>
        <h1 class="text-3xl font-bold">{product.title}</h1>
        <p class="mt-2 text-gray-700">{product.description}</p>
        <p class="text-sm text-gray-500">Slug: {product.slug}</p>
      </div>
    </div>
    
    
    <script type="module">
      import Splide from 'https://cdn.jsdelivr.net/npm/@splidejs/splide@4.1.3/dist/js/splide.esm.min.js';
      import Vlitejs from 'https://cdn.jsdelivr.net/npm/vlitejs@6';
      const splide = new Splide('#product-carousel', {
        type: 'loop',
        perPage: 1,
        autoplay: false,
        pagination: true,
      });

      splide.mount();

      new Vlitejs(document.querySelector('#product-video'),{
        options:{
          autoplay: false,
        }
      });
    </script>
  </body>
</Layout>

<style>
  .video-container :global(.v-vlite){
    width: 100%;
    height: 100%;
    object-fit: contain;
  }
  .video-container :global(.v-bigPlay) :global(svg) {
    fill: burlywood;
  }
</style>